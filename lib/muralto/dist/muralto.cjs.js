"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const B=require("react"),r=require("three"),Ht=require("dat.gui"),Ft=require("gsap"),Gt=require("n8ao");function Ot(a){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const t in a)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(a,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>a[t]})}}return e.default=a,Object.freeze(e)}const N=Ot(r),Bt=Ot(Ht);var Xe={exports:{}},je={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dt;function Ut(){if(dt)return je;dt=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,n,o){var s=null;if(o!==void 0&&(s=""+o),n.key!==void 0&&(s=""+n.key),"key"in n){o={};for(var c in n)c!=="key"&&(o[c]=n[c])}else o=n;return n=o.ref,{$$typeof:a,type:i,key:s,ref:n!==void 0?n:null,props:o}}return je.Fragment=e,je.jsx=t,je.jsxs=t,je}var ke={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ft;function zt(){return ft||(ft=1,process.env.NODE_ENV!=="production"&&function(){function a(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===se?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case E:return"Fragment";case Y:return"Portal";case P:return"Profiler";case A:return"StrictMode";case W:return"Suspense";case le:return"SuspenseList"}if(typeof h=="object")switch(typeof h.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),h.$$typeof){case L:return(h.displayName||"Context")+".Provider";case C:return(h._context.displayName||"Context")+".Consumer";case re:var _=h.render;return h=h.displayName,h||(h=_.displayName||_.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case X:return _=h.displayName||null,_!==null?_:a(h.type)||"Memo";case G:_=h._payload,h=h._init;try{return a(h(_))}catch{}}return null}function e(h){return""+h}function t(h){try{e(h);var _=!1}catch{_=!0}if(_){_=console;var w=_.error,D=typeof Symbol=="function"&&Symbol.toStringTag&&h[Symbol.toStringTag]||h.constructor.name||"Object";return w.call(_,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",D),e(h)}}function i(){}function n(){if(te===0){ze=console.log,Re=console.info,Oe=console.warn,ge=console.error,Ve=console.group,Pe=console.groupCollapsed,de=console.groupEnd;var h={configurable:!0,enumerable:!0,value:i,writable:!0};Object.defineProperties(console,{info:h,log:h,warn:h,error:h,group:h,groupCollapsed:h,groupEnd:h})}te++}function o(){if(te--,te===0){var h={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:$({},h,{value:ze}),info:$({},h,{value:Re}),warn:$({},h,{value:Oe}),error:$({},h,{value:ge}),group:$({},h,{value:Ve}),groupCollapsed:$({},h,{value:Pe}),groupEnd:$({},h,{value:de})})}0>te&&console.error("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}function s(h){if(xe===void 0)try{throw Error()}catch(w){var _=w.stack.trim().match(/\n( *(at )?)/);xe=_&&_[1]||"",Te=-1<w.stack.indexOf(`
    at`)?" (<anonymous>)":-1<w.stack.indexOf("@")?"@unknown:0:0":""}return`
`+xe+h+Te}function c(h,_){if(!h||ie)return"";var w=_e.get(h);if(w!==void 0)return w;ie=!0,w=Error.prepareStackTrace,Error.prepareStackTrace=void 0;var D=null;D=k.H,k.H=null,n();try{var J={DetermineComponentFrameRoot:function(){try{if(_){var ye=function(){throw Error()};if(Object.defineProperty(ye.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ye,[])}catch(pe){var Ye=pe}Reflect.construct(h,[],ye)}else{try{ye.call()}catch(pe){Ye=pe}h.call(ye.prototype)}}else{try{throw Error()}catch(pe){Ye=pe}(ye=h())&&typeof ye.catch=="function"&&ye.catch(function(){})}}catch(pe){if(pe&&Ye&&typeof pe.stack=="string")return[pe.stack,Ye.stack]}return[null,null]}};J.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var z=Object.getOwnPropertyDescriptor(J.DetermineComponentFrameRoot,"name");z&&z.configurable&&Object.defineProperty(J.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=J.DetermineComponentFrameRoot(),fe=S[0],Ce=S[1];if(fe&&Ce){var ne=fe.split(`
`),Ee=Ce.split(`
`);for(S=z=0;z<ne.length&&!ne[z].includes("DetermineComponentFrameRoot");)z++;for(;S<Ee.length&&!Ee[S].includes("DetermineComponentFrameRoot");)S++;if(z===ne.length||S===Ee.length)for(z=ne.length-1,S=Ee.length-1;1<=z&&0<=S&&ne[z]!==Ee[S];)S--;for(;1<=z&&0<=S;z--,S--)if(ne[z]!==Ee[S]){if(z!==1||S!==1)do if(z--,S--,0>S||ne[z]!==Ee[S]){var Ne=`
`+ne[z].replace(" at new "," at ");return h.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",h.displayName)),typeof h=="function"&&_e.set(h,Ne),Ne}while(1<=z&&0<=S);break}}}finally{ie=!1,k.H=D,o(),Error.prepareStackTrace=w}return ne=(ne=h?h.displayName||h.name:"")?s(ne):"",typeof h=="function"&&_e.set(h,ne),ne}function l(h){if(h==null)return"";if(typeof h=="function"){var _=h.prototype;return c(h,!(!_||!_.isReactComponent))}if(typeof h=="string")return s(h);switch(h){case W:return s("Suspense");case le:return s("SuspenseList")}if(typeof h=="object")switch(h.$$typeof){case re:return h=c(h.render,!1),h;case X:return l(h.type);case G:_=h._payload,h=h._init;try{return l(h(_))}catch{}}return""}function u(){var h=k.A;return h===null?null:h.getOwner()}function f(h){if(ae.call(h,"key")){var _=Object.getOwnPropertyDescriptor(h,"key").get;if(_&&_.isReactWarning)return!1}return h.key!==void 0}function d(h,_){function w(){De||(De=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",_))}w.isReactWarning=!0,Object.defineProperty(h,"key",{get:w,configurable:!0})}function p(){var h=a(this.type);return I[h]||(I[h]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),h=this.props.ref,h!==void 0?h:null}function m(h,_,w,D,J,z){return w=z.ref,h={$$typeof:x,type:h,key:_,props:z,_owner:J},(w!==void 0?w:null)!==null?Object.defineProperty(h,"ref",{enumerable:!1,get:p}):Object.defineProperty(h,"ref",{enumerable:!1,value:null}),h._store={},Object.defineProperty(h._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(h,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.freeze&&(Object.freeze(h.props),Object.freeze(h)),h}function g(h,_,w,D,J,z){if(typeof h=="string"||typeof h=="function"||h===E||h===P||h===A||h===W||h===le||h===O||typeof h=="object"&&h!==null&&(h.$$typeof===G||h.$$typeof===X||h.$$typeof===L||h.$$typeof===C||h.$$typeof===re||h.$$typeof===he||h.getModuleId!==void 0)){var S=_.children;if(S!==void 0)if(D)if(Z(S)){for(D=0;D<S.length;D++)T(S[D],h);Object.freeze&&Object.freeze(S)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else T(S,h)}else S="",(h===void 0||typeof h=="object"&&h!==null&&Object.keys(h).length===0)&&(S+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports."),h===null?D="null":Z(h)?D="array":h!==void 0&&h.$$typeof===x?(D="<"+(a(h.type)||"Unknown")+" />",S=" Did you accidentally export a JSX literal instead of a component?"):D=typeof h,console.error("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",D,S);if(ae.call(_,"key")){S=a(h);var fe=Object.keys(_).filter(function(ne){return ne!=="key"});D=0<fe.length?"{key: someKey, "+fe.join(": ..., ")+": ...}":"{key: someKey}",V[S+D]||(fe=0<fe.length?"{"+fe.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,D,S,fe,S),V[S+D]=!0)}if(S=null,w!==void 0&&(t(w),S=""+w),f(_)&&(t(_.key),S=""+_.key),"key"in _){w={};for(var Ce in _)Ce!=="key"&&(w[Ce]=_[Ce])}else w=_;return S&&d(w,typeof h=="function"?h.displayName||h.name||"Unknown":h),m(h,S,z,J,u(),w)}function T(h,_){if(typeof h=="object"&&h&&h.$$typeof!==Ie){if(Z(h))for(var w=0;w<h.length;w++){var D=h[w];y(D)&&b(D,_)}else if(y(h))h._store&&(h._store.validated=1);else if(h===null||typeof h!="object"?w=null:(w=K&&h[K]||h["@@iterator"],w=typeof w=="function"?w:null),typeof w=="function"&&w!==h.entries&&(w=w.call(h),w!==h))for(;!(h=w.next()).done;)y(h.value)&&b(h.value,_)}}function y(h){return typeof h=="object"&&h!==null&&h.$$typeof===x}function b(h,_){if(h._store&&!h._store.validated&&h.key==null&&(h._store.validated=1,_=M(_),!q[_])){q[_]=!0;var w="";h&&h._owner!=null&&h._owner!==u()&&(w=null,typeof h._owner.tag=="number"?w=a(h._owner.type):typeof h._owner.name=="string"&&(w=h._owner.name),w=" It was passed a child from "+w+".");var D=k.getCurrentStack;k.getCurrentStack=function(){var J=l(h.type);return D&&(J+=D()||""),J},console.error('Each child in a list should have a unique "key" prop.%s%s See https://react.dev/link/warning-keys for more information.',_,w),k.getCurrentStack=D}}function M(h){var _="",w=u();return w&&(w=a(w.type))&&(_=`

Check the render method of \``+w+"`."),_||(h=a(h))&&(_=`

Check the top-level render call using <`+h+">."),_}var v=B,x=Symbol.for("react.transitional.element"),Y=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),L=Symbol.for("react.context"),re=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),le=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),O=Symbol.for("react.offscreen"),K=Symbol.iterator,se=Symbol.for("react.client.reference"),k=v.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae=Object.prototype.hasOwnProperty,$=Object.assign,he=Symbol.for("react.client.reference"),Z=Array.isArray,te=0,ze,Re,Oe,ge,Ve,Pe,de;i.__reactDisabledLog=!0;var xe,Te,ie=!1,_e=new(typeof WeakMap=="function"?WeakMap:Map),Ie=Symbol.for("react.client.reference"),De,I={},V={},q={};ke.Fragment=E,ke.jsx=function(h,_,w,D,J){return g(h,_,w,!1,D,J)},ke.jsxs=function(h,_,w,D,J){return g(h,_,w,!0,D,J)}}()),ke}var pt;function Vt(){return pt||(pt=1,process.env.NODE_ENV==="production"?Xe.exports=Ut():Xe.exports=zt()),Xe.exports}var j=Vt();function mt(a,e){if(e===r.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===r.TriangleFanDrawMode||e===r.TriangleStripDrawMode){let t=a.getIndex();if(t===null){const s=[],c=a.getAttribute("position");if(c!==void 0){for(let l=0;l<c.count;l++)s.push(l);a.setIndex(s),t=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const i=t.count-2,n=[];if(e===r.TriangleFanDrawMode)for(let s=1;s<=i;s++)n.push(t.getX(0)),n.push(t.getX(s)),n.push(t.getX(s+1));else for(let s=0;s<i;s++)s%2===0?(n.push(t.getX(s)),n.push(t.getX(s+1)),n.push(t.getX(s+2))):(n.push(t.getX(s+2)),n.push(t.getX(s+1)),n.push(t.getX(s)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=a.clone();return o.setIndex(n),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}class Yt extends r.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Wt(t)}),this.register(function(t){return new qt(t)}),this.register(function(t){return new an(t)}),this.register(function(t){return new cn(t)}),this.register(function(t){return new ln(t)}),this.register(function(t){return new Jt(t)}),this.register(function(t){return new en(t)}),this.register(function(t){return new tn(t)}),this.register(function(t){return new nn(t)}),this.register(function(t){return new Qt(t)}),this.register(function(t){return new sn(t)}),this.register(function(t){return new $t(t)}),this.register(function(t){return new rn(t)}),this.register(function(t){return new on(t)}),this.register(function(t){return new Kt(t)}),this.register(function(t){return new hn(t)}),this.register(function(t){return new un(t)})}load(e,t,i,n){const o=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const u=r.LoaderUtils.extractUrlBase(e);s=r.LoaderUtils.resolveURL(u,this.path)}else s=r.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const c=function(u){n?n(u):console.error(u),o.manager.itemError(e),o.manager.itemEnd(e)},l=new r.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{o.parse(u,s,function(f){t(f),o.manager.itemEnd(e)},c)}catch(f){c(f)}},i,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let o;const s={},c={},l=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===It){try{s[R.KHR_BINARY_GLTF]=new dn(e)}catch(d){n&&n(d);return}o=JSON.parse(s[R.KHR_BINARY_GLTF].content)}else o=JSON.parse(l.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new Mn(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const d=this.pluginCallbacks[f](u);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[d.name]=d,s[d.name]=!0}if(o.extensionsUsed)for(let f=0;f<o.extensionsUsed.length;++f){const d=o.extensionsUsed[f],p=o.extensionsRequired||[];switch(d){case R.KHR_MATERIALS_UNLIT:s[d]=new Zt;break;case R.KHR_DRACO_MESH_COMPRESSION:s[d]=new fn(o,this.dracoLoader);break;case R.KHR_TEXTURE_TRANSFORM:s[d]=new pn;break;case R.KHR_MESH_QUANTIZATION:s[d]=new mn;break;default:p.indexOf(d)>=0&&c[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}u.setExtensions(s),u.setPlugins(c),u.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,o){i.parse(e,t,n,o)})}}function Xt(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const R={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Kt{constructor(e){this.parser=e,this.name=R.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const o=t[i];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const o=t.json,l=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let u;const f=new r.Color(16777215);l.color!==void 0&&f.setRGB(l.color[0],l.color[1],l.color[2],r.LinearSRGBColorSpace);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":u=new r.DirectionalLight(f),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new r.PointLight(f),u.distance=d;break;case"spot":u=new r.SpotLight(f),u.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),u.decay=2,me(u,l),l.intensity!==void 0&&(u.intensity=l.intensity),u.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(u),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,o=i.json.nodes[e],c=(o.extensions&&o.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(l){return i._getNodeRef(t.cache,c,l)})}}class Zt{constructor(){this.name=R.KHR_MATERIALS_UNLIT}getMaterialType(){return r.MeshBasicMaterial}extendParams(e,t,i){const n=[];e.color=new r.Color(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const s=o.baseColorFactor;e.color.setRGB(s[0],s[1],s[2],r.LinearSRGBColorSpace),e.opacity=s[3]}o.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",o.baseColorTexture,r.SRGBColorSpace))}return Promise.all(n)}}class Qt{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class Wt{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(o.push(i.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const c=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new r.Vector2(c,c)}return Promise.all(o)}}class qt{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class $t{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(o)}}class Jt{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new r.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=n.extensions[this.name];if(s.sheenColorFactor!==void 0){const c=s.sheenColorFactor;t.sheenColor.setRGB(c[0],c[1],c[2],r.LinearSRGBColorSpace)}return s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&o.push(i.assignTexture(t,"sheenColorMap",s.sheenColorTexture,r.SRGBColorSpace)),s.sheenRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(o)}}class en{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&o.push(i.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(o)}}class tn{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&o.push(i.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const c=s.attenuationColor||[1,1,1];return t.attenuationColor=new r.Color().setRGB(c[0],c[1],c[2],r.LinearSRGBColorSpace),Promise.all(o)}}class nn{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class sn{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&o.push(i.assignTexture(t,"specularIntensityMap",s.specularTexture));const c=s.specularColorFactor||[1,1,1];return t.specularColor=new r.Color().setRGB(c[0],c[1],c[2],r.LinearSRGBColorSpace),s.specularColorTexture!==void 0&&o.push(i.assignTexture(t,"specularColorMap",s.specularColorTexture,r.SRGBColorSpace)),Promise.all(o)}}class on{constructor(e){this.parser=e,this.name=R.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return t.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&o.push(i.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(o)}}class rn{constructor(e){this.parser=e,this.name=R.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:r.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return s.anisotropyStrength!==void 0&&(t.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(t.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&o.push(i.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(o)}}class an{constructor(e){this.parser=e,this.name=R.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,s)}}class cn{constructor(e){this.parser=e,this.name=R.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const s=o.extensions[t],c=n.images[s.source];let l=i.textureLoader;if(c.uri){const u=i.options.manager.getHandler(c.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,s.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ln{constructor(e){this.parser=e,this.name=R.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const s=o.extensions[t],c=n.images[s.source];let l=i.textureLoader;if(c.uri){const u=i.options.manager.getHandler(c.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,s.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class hn{constructor(e){this.name=R.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],o=this.parser.getDependency("buffer",n.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(c){const l=n.byteOffset||0,u=n.byteLength||0,f=n.count,d=n.byteStride,p=new Uint8Array(c,l,u);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(f,d,p,n.mode,n.filter).then(function(m){return m.buffer}):s.ready.then(function(){const m=new ArrayBuffer(f*d);return s.decodeGltfBuffer(new Uint8Array(m),f,d,p,n.mode,n.filter),m})})}else return null}}class un{constructor(e){this.name=R.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const u of n.primitives)if(u.mode!==ce.TRIANGLES&&u.mode!==ce.TRIANGLE_STRIP&&u.mode!==ce.TRIANGLE_FAN&&u.mode!==void 0)return null;const s=i.extensions[this.name].attributes,c=[],l={};for(const u in s)c.push(this.parser.getDependency("accessor",s[u]).then(f=>(l[u]=f,l[u])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(u=>{const f=u.pop(),d=f.isGroup?f.children:[f],p=u[0].count,m=[];for(const g of d){const T=new r.Matrix4,y=new r.Vector3,b=new r.Quaternion,M=new r.Vector3(1,1,1),v=new r.InstancedMesh(g.geometry,g.material,p);for(let x=0;x<p;x++)l.TRANSLATION&&y.fromBufferAttribute(l.TRANSLATION,x),l.ROTATION&&b.fromBufferAttribute(l.ROTATION,x),l.SCALE&&M.fromBufferAttribute(l.SCALE,x),v.setMatrixAt(x,T.compose(y,b,M));for(const x in l)if(x==="_COLOR_0"){const Y=l[x];v.instanceColor=new r.InstancedBufferAttribute(Y.array,Y.itemSize,Y.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&g.geometry.setAttribute(x,l[x]);r.Object3D.prototype.copy.call(v,g),this.parser.assignFinalMaterial(v),m.push(v)}return f.isGroup?(f.clear(),f.add(...m),f):m[0]}))}}const It="glTF",He=12,gt={JSON:1313821514,BIN:5130562};class dn{constructor(e){this.name=R.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,He),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==It)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-He,o=new DataView(e,He);let s=0;for(;s<n;){const c=o.getUint32(s,!0);s+=4;const l=o.getUint32(s,!0);if(s+=4,l===gt.JSON){const u=new Uint8Array(e,He+s,c);this.content=i.decode(u)}else if(l===gt.BIN){const u=He+s;this.body=e.slice(u,u+c)}s+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class fn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=R.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,c={},l={},u={};for(const f in s){const d=lt[f]||f.toLowerCase();c[d]=s[f]}for(const f in e.attributes){const d=lt[f]||f.toLowerCase();if(s[f]!==void 0){const p=i.accessors[e.attributes[f]],m=Le[p.componentType];u[d]=m.name,l[d]=p.normalized===!0}}return t.getDependency("bufferView",o).then(function(f){return new Promise(function(d,p){n.decodeDracoFile(f,function(m){for(const g in m.attributes){const T=m.attributes[g],y=l[g];y!==void 0&&(T.normalized=y)}d(m)},c,u,r.LinearSRGBColorSpace,p)})})}}class pn{constructor(){this.name=R.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class mn{constructor(){this.name=R.KHR_MESH_QUANTIZATION}}class Dt extends r.Interpolant{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,o=e*n*3+n;for(let s=0;s!==n;s++)t[s]=i[o+s];return t}interpolate_(e,t,i,n){const o=this.resultBuffer,s=this.sampleValues,c=this.valueSize,l=c*2,u=c*3,f=n-t,d=(i-t)/f,p=d*d,m=p*d,g=e*u,T=g-u,y=-2*m+3*p,b=m-p,M=1-y,v=b-p+d;for(let x=0;x!==c;x++){const Y=s[T+x+c],E=s[T+x+l]*f,A=s[g+x+c],P=s[g+x]*f;o[x]=M*Y+v*E+y*A+b*P}return o}}const gn=new r.Quaternion;class _n extends Dt{interpolate_(e,t,i,n){const o=super.interpolate_(e,t,i,n);return gn.fromArray(o).normalize().toArray(o),o}}const ce={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Le={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_t={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},yt={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},nt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},we={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},yn={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete},st={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function wn(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new r.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide})),a.DefaultMaterial}function Ae(a,e,t){for(const i in t.extensions)a[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function me(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function bn(a,e,t){let i=!1,n=!1,o=!1;for(let u=0,f=e.length;u<f;u++){const d=e[u];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(o=!0),i&&n&&o)break}if(!i&&!n&&!o)return Promise.resolve(a);const s=[],c=[],l=[];for(let u=0,f=e.length;u<f;u++){const d=e[u];if(i){const p=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):a.attributes.position;s.push(p)}if(n){const p=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):a.attributes.normal;c.push(p)}if(o){const p=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):a.attributes.color;l.push(p)}}return Promise.all([Promise.all(s),Promise.all(c),Promise.all(l)]).then(function(u){const f=u[0],d=u[1],p=u[2];return i&&(a.morphAttributes.position=f),n&&(a.morphAttributes.normal=d),o&&(a.morphAttributes.color=p),a.morphTargetsRelative=!0,a})}function xn(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)a.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Tn(a){let e;const t=a.extensions&&a.extensions[R.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+it(t.attributes):e=a.indices+":"+it(a.attributes)+":"+a.mode,a.targets!==void 0)for(let i=0,n=a.targets.length;i<n;i++)e+=":"+it(a.targets[i]);return e}function it(a){let e="";const t=Object.keys(a).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+a[t[i]]+";";return e}function ht(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function En(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":a.search(/\.ktx2($|\?)/i)>0||a.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const An=new r.Matrix4;class Mn{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Xt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,o=!1,s=-1;if(typeof navigator<"u"){const c=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(c)===!0;const l=c.match(/Version\/(\d+)/);n=i&&l?parseInt(l[1],10):-1,o=c.indexOf("Firefox")>-1,s=o?c.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&n<17||o&&s<98?this.textureLoader=new r.TextureLoader(this.options.manager):this.textureLoader=new r.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(s){const c={scene:s[0][n.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:n.asset,parser:i,userData:{}};return Ae(o,c,n),me(c,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(c)})).then(function(){for(const l of c.scenes)l.updateMatrixWorld();e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,o=t.length;n<o;n++){const s=t[n].joints;for(let c=0,l=s.length;c<l;c++)e[s[c]].isBone=!0}for(let n=0,o=e.length;n<o;n++){const s=e[n];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(i[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),o=(s,c)=>{const l=this.associations.get(s);l!=null&&this.associations.set(c,l);for(const[u,f]of s.children.entries())o(f,c.children[u])};return o(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const o=e(t[n]);o&&i.push(o)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":n=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(o,s){return i.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[R.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(o,s){i.load(r.LoaderUtils.resolveURL(t.uri,n.path),o,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,o=t.byteOffset||0;return i.slice(o,o+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const s=nt[n.type],c=Le[n.componentType],l=n.normalized===!0,u=new c(n.count*s);return Promise.resolve(new r.BufferAttribute(u,s,l))}const o=[];return n.bufferView!==void 0?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),n.sparse!==void 0&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then(function(s){const c=s[0],l=nt[n.type],u=Le[n.componentType],f=u.BYTES_PER_ELEMENT,d=f*l,p=n.byteOffset||0,m=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,g=n.normalized===!0;let T,y;if(m&&m!==d){const b=Math.floor(p/m),M="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+b+":"+n.count;let v=t.cache.get(M);v||(T=new u(c,b*m,n.count*m/f),v=new r.InterleavedBuffer(T,m/f),t.cache.add(M,v)),y=new r.InterleavedBufferAttribute(v,l,p%m/f,g)}else c===null?T=new u(n.count*l):T=new u(c,p,n.count*l),y=new r.BufferAttribute(T,l,g);if(n.sparse!==void 0){const b=nt.SCALAR,M=Le[n.sparse.indices.componentType],v=n.sparse.indices.byteOffset||0,x=n.sparse.values.byteOffset||0,Y=new M(s[1],v,n.sparse.count*b),E=new u(s[2],x,n.sparse.count*l);c!==null&&(y=new r.BufferAttribute(y.array.slice(),y.itemSize,y.normalized)),y.normalized=!1;for(let A=0,P=Y.length;A<P;A++){const C=Y[A];if(y.setX(C,E[A*l]),l>=2&&y.setY(C,E[A*l+1]),l>=3&&y.setZ(C,E[A*l+2]),l>=4&&y.setW(C,E[A*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}y.normalized=g}return y})}loadTexture(e){const t=this.json,i=this.options,o=t.textures[e].source,s=t.images[o];let c=this.textureLoader;if(s.uri){const l=i.manager.getHandler(s.uri);l!==null&&(c=l)}return this.loadTextureImage(e,o,c)}loadTextureImage(e,t,i){const n=this,o=this.json,s=o.textures[e],c=o.images[t],l=(c.uri||c.bufferView)+":"+s.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(t,i).then(function(f){f.flipY=!1,f.name=s.name||c.name||"",f.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(f.name=c.uri);const p=(o.samplers||{})[s.sampler]||{};return f.magFilter=_t[p.magFilter]||r.LinearFilter,f.minFilter=_t[p.minFilter]||r.LinearMipmapLinearFilter,f.wrapS=yt[p.wrapS]||r.RepeatWrapping,f.wrapT=yt[p.wrapT]||r.RepeatWrapping,f.generateMipmaps=!f.isCompressedTexture&&f.minFilter!==r.NearestFilter&&f.minFilter!==r.LinearFilter,n.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,t){const i=this,n=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const s=n.images[e],c=self.URL||self.webkitURL;let l=s.uri||"",u=!1;if(s.bufferView!==void 0)l=i.getDependency("bufferView",s.bufferView).then(function(d){u=!0;const p=new Blob([d],{type:s.mimeType});return l=c.createObjectURL(p),l});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(l).then(function(d){return new Promise(function(p,m){let g=p;t.isImageBitmapLoader===!0&&(g=function(T){const y=new r.Texture(T);y.needsUpdate=!0,p(y)}),t.load(r.LoaderUtils.resolveURL(d,o.path),g,void 0,m)})}).then(function(d){return u===!0&&c.revokeObjectURL(l),me(d,s),d.userData.mimeType=s.mimeType||En(s.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=f,f}assignTexture(e,t,i,n){const o=this;return this.getDependency("texture",i.index).then(function(s){if(!s)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(s=s.clone(),s.channel=i.texCoord),o.extensions[R.KHR_TEXTURE_TRANSFORM]){const c=i.extensions!==void 0?i.extensions[R.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const l=o.associations.get(s);s=o.extensions[R.KHR_TEXTURE_TRANSFORM].extendTexture(s,c),o.associations.set(s,l)}}return n!==void 0&&(s.colorSpace=n),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+i.uuid;let l=this.cache.get(c);l||(l=new r.PointsMaterial,r.Material.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(c,l)),i=l}else if(e.isLine){const c="LineBasicMaterial:"+i.uuid;let l=this.cache.get(c);l||(l=new r.LineBasicMaterial,r.Material.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(c,l)),i=l}if(n||o||s){let c="ClonedMaterial:"+i.uuid+":";n&&(c+="derivative-tangents:"),o&&(c+="vertex-colors:"),s&&(c+="flat-shading:");let l=this.cache.get(c);l||(l=i.clone(),o&&(l.vertexColors=!0),s&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(c,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return r.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,n=this.extensions,o=i.materials[e];let s;const c={},l=o.extensions||{},u=[];if(l[R.KHR_MATERIALS_UNLIT]){const d=n[R.KHR_MATERIALS_UNLIT];s=d.getMaterialType(),u.push(d.extendParams(c,o,t))}else{const d=o.pbrMetallicRoughness||{};if(c.color=new r.Color(1,1,1),c.opacity=1,Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;c.color.setRGB(p[0],p[1],p[2],r.LinearSRGBColorSpace),c.opacity=p[3]}d.baseColorTexture!==void 0&&u.push(t.assignTexture(c,"map",d.baseColorTexture,r.SRGBColorSpace)),c.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,c.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(c,"metalnessMap",d.metallicRoughnessTexture)),u.push(t.assignTexture(c,"roughnessMap",d.metallicRoughnessTexture))),s=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,c)})))}o.doubleSided===!0&&(c.side=r.DoubleSide);const f=o.alphaMode||st.OPAQUE;if(f===st.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,f===st.MASK&&(c.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&s!==r.MeshBasicMaterial&&(u.push(t.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new r.Vector2(1,1),o.normalTexture.scale!==void 0)){const d=o.normalTexture.scale;c.normalScale.set(d,d)}if(o.occlusionTexture!==void 0&&s!==r.MeshBasicMaterial&&(u.push(t.assignTexture(c,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&s!==r.MeshBasicMaterial){const d=o.emissiveFactor;c.emissive=new r.Color().setRGB(d[0],d[1],d[2],r.LinearSRGBColorSpace)}return o.emissiveTexture!==void 0&&s!==r.MeshBasicMaterial&&u.push(t.assignTexture(c,"emissiveMap",o.emissiveTexture,r.SRGBColorSpace)),Promise.all(u).then(function(){const d=new s(c);return o.name&&(d.name=o.name),me(d,o),t.associations.set(d,{materials:e}),o.extensions&&Ae(n,d,o),d})}createUniqueName(e){const t=r.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function o(c){return i[R.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(l){return wt(l,c,t)})}const s=[];for(let c=0,l=e.length;c<l;c++){const u=e[c],f=Tn(u),d=n[f];if(d)s.push(d.promise);else{let p;u.extensions&&u.extensions[R.KHR_DRACO_MESH_COMPRESSION]?p=o(u):p=wt(new r.BufferGeometry,u,t),n[f]={primitive:u,promise:p},s.push(p)}}return Promise.all(s)}loadMesh(e){const t=this,i=this.json,n=this.extensions,o=i.meshes[e],s=o.primitives,c=[];for(let l=0,u=s.length;l<u;l++){const f=s[l].material===void 0?wn(this.cache):this.getDependency("material",s[l].material);c.push(f)}return c.push(t.loadGeometries(s)),Promise.all(c).then(function(l){const u=l.slice(0,l.length-1),f=l[l.length-1],d=[];for(let m=0,g=f.length;m<g;m++){const T=f[m],y=s[m];let b;const M=u[m];if(y.mode===ce.TRIANGLES||y.mode===ce.TRIANGLE_STRIP||y.mode===ce.TRIANGLE_FAN||y.mode===void 0)b=o.isSkinnedMesh===!0?new r.SkinnedMesh(T,M):new r.Mesh(T,M),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),y.mode===ce.TRIANGLE_STRIP?b.geometry=mt(b.geometry,r.TriangleStripDrawMode):y.mode===ce.TRIANGLE_FAN&&(b.geometry=mt(b.geometry,r.TriangleFanDrawMode));else if(y.mode===ce.LINES)b=new r.LineSegments(T,M);else if(y.mode===ce.LINE_STRIP)b=new r.Line(T,M);else if(y.mode===ce.LINE_LOOP)b=new r.LineLoop(T,M);else if(y.mode===ce.POINTS)b=new r.Points(T,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(b.geometry.morphAttributes).length>0&&xn(b,o),b.name=t.createUniqueName(o.name||"mesh_"+e),me(b,o),y.extensions&&Ae(n,b,y),t.assignFinalMaterial(b),d.push(b)}for(let m=0,g=d.length;m<g;m++)t.associations.set(d[m],{meshes:e,primitives:m});if(d.length===1)return o.extensions&&Ae(n,d[0],o),d[0];const p=new r.Group;o.extensions&&Ae(n,p,o),t.associations.set(p,{meshes:e});for(let m=0,g=d.length;m<g;m++)p.add(d[m]);return p})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new r.PerspectiveCamera(r.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new r.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),me(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,o=t.joints.length;n<o;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const o=n.pop(),s=n,c=[],l=[];for(let u=0,f=s.length;u<f;u++){const d=s[u];if(d){c.push(d);const p=new r.Matrix4;o!==null&&p.fromArray(o.array,u*16),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new r.Skeleton(c,l)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],o=n.name?n.name:"animation_"+e,s=[],c=[],l=[],u=[],f=[];for(let d=0,p=n.channels.length;d<p;d++){const m=n.channels[d],g=n.samplers[m.sampler],T=m.target,y=T.node,b=n.parameters!==void 0?n.parameters[g.input]:g.input,M=n.parameters!==void 0?n.parameters[g.output]:g.output;T.node!==void 0&&(s.push(this.getDependency("node",y)),c.push(this.getDependency("accessor",b)),l.push(this.getDependency("accessor",M)),u.push(g),f.push(T))}return Promise.all([Promise.all(s),Promise.all(c),Promise.all(l),Promise.all(u),Promise.all(f)]).then(function(d){const p=d[0],m=d[1],g=d[2],T=d[3],y=d[4],b=[];for(let M=0,v=p.length;M<v;M++){const x=p[M],Y=m[M],E=g[M],A=T[M],P=y[M];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const C=i._createAnimationTracks(x,Y,E,A,P);if(C)for(let L=0;L<C.length;L++)b.push(C[L])}return new r.AnimationClip(o,void 0,b)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(o){const s=i._getNodeRef(i.meshCache,n.mesh,o);return n.weights!==void 0&&s.traverse(function(c){if(c.isMesh)for(let l=0,u=n.weights.length;l<u;l++)c.morphTargetInfluences[l]=n.weights[l]}),s})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],o=i._loadNodeShallow(e),s=[],c=n.children||[];for(let u=0,f=c.length;u<f;u++)s.push(i.getDependency("node",c[u]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([o,Promise.all(s),l]).then(function(u){const f=u[0],d=u[1],p=u[2];p!==null&&f.traverse(function(m){m.isSkinnedMesh&&m.bind(p,An)});for(let m=0,g=d.length;m<g;m++)f.add(d[m]);return f})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],s=o.name?n.createUniqueName(o.name):"",c=[],l=n._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return l&&c.push(l),o.camera!==void 0&&c.push(n.getDependency("camera",o.camera).then(function(u){return n._getNodeRef(n.cameraCache,o.camera,u)})),n._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){c.push(u)}),this.nodeCache[e]=Promise.all(c).then(function(u){let f;if(o.isBone===!0?f=new r.Bone:u.length>1?f=new r.Group:u.length===1?f=u[0]:f=new r.Object3D,f!==u[0])for(let d=0,p=u.length;d<p;d++)f.add(u[d]);if(o.name&&(f.userData.name=o.name,f.name=s),me(f,o),o.extensions&&Ae(i,f,o),o.matrix!==void 0){const d=new r.Matrix4;d.fromArray(o.matrix),f.applyMatrix4(d)}else o.translation!==void 0&&f.position.fromArray(o.translation),o.rotation!==void 0&&f.quaternion.fromArray(o.rotation),o.scale!==void 0&&f.scale.fromArray(o.scale);return n.associations.has(f)||n.associations.set(f,{}),n.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,o=new r.Group;i.name&&(o.name=n.createUniqueName(i.name)),me(o,i),i.extensions&&Ae(t,o,i);const s=i.nodes||[],c=[];for(let l=0,u=s.length;l<u;l++)c.push(n.getDependency("node",s[l]));return Promise.all(c).then(function(l){for(let f=0,d=l.length;f<d;f++)o.add(l[f]);const u=f=>{const d=new Map;for(const[p,m]of n.associations)(p instanceof r.Material||p instanceof r.Texture)&&d.set(p,m);return f.traverse(p=>{const m=n.associations.get(p);m!=null&&d.set(p,m)}),d};return n.associations=u(o),o})}_createAnimationTracks(e,t,i,n,o){const s=[],c=e.name?e.name:e.uuid,l=[];we[o.path]===we.weights?e.traverse(function(p){p.morphTargetInfluences&&l.push(p.name?p.name:p.uuid)}):l.push(c);let u;switch(we[o.path]){case we.weights:u=r.NumberKeyframeTrack;break;case we.rotation:u=r.QuaternionKeyframeTrack;break;case we.position:case we.scale:u=r.VectorKeyframeTrack;break;default:switch(i.itemSize){case 1:u=r.NumberKeyframeTrack;break;case 2:case 3:default:u=r.VectorKeyframeTrack;break}break}const f=n.interpolation!==void 0?yn[n.interpolation]:r.InterpolateLinear,d=this._getArrayFromAccessor(i);for(let p=0,m=l.length;p<m;p++){const g=new u(l[p]+"."+we[o.path],t.array,d,f);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),s.push(g)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=ht(t.constructor),n=new Float32Array(t.length);for(let o=0,s=t.length;o<s;o++)n[o]=t[o]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof r.QuaternionKeyframeTrack?_n:Dt;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Sn(a,e,t){const i=e.attributes,n=new r.Box3;if(i.POSITION!==void 0){const c=t.json.accessors[i.POSITION],l=c.min,u=c.max;if(l!==void 0&&u!==void 0){if(n.set(new r.Vector3(l[0],l[1],l[2]),new r.Vector3(u[0],u[1],u[2])),c.normalized){const f=ht(Le[c.componentType]);n.min.multiplyScalar(f),n.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const c=new r.Vector3,l=new r.Vector3;for(let u=0,f=o.length;u<f;u++){const d=o[u];if(d.POSITION!==void 0){const p=t.json.accessors[d.POSITION],m=p.min,g=p.max;if(m!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),p.normalized){const T=ht(Le[p.componentType]);l.multiplyScalar(T)}c.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(c)}a.boundingBox=n;const s=new r.Sphere;n.getCenter(s.center),s.radius=n.min.distanceTo(n.max)/2,a.boundingSphere=s}function wt(a,e,t){const i=e.attributes,n=[];function o(s,c){return t.getDependency("accessor",s).then(function(l){a.setAttribute(c,l)})}for(const s in i){const c=lt[s]||s.toLowerCase();c in a.attributes||n.push(o(i[s],c))}if(e.indices!==void 0&&!a.index){const s=t.getDependency("accessor",e.indices).then(function(c){a.setIndex(c)});n.push(s)}return r.ColorManagement.workingColorSpace!==r.LinearSRGBColorSpace&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${r.ColorManagement.workingColorSpace}" not supported.`),me(a,e),Sn(a,e,t),Promise.all(n).then(function(){return e.targets!==void 0?bn(a,e.targets,t):a})}const bt={type:"change"},ut={type:"start"},Nt={type:"end"},Ke=new r.Ray,xt=new r.Plane,Rn=Math.cos(70*r.MathUtils.DEG2RAD),Q=new r.Vector3,oe=2*Math.PI,H={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},ot=1e-6;class Pn extends r.Controls{constructor(e,t=null){super(e,t),this.state=H.NONE,this.enabled=!0,this.target=new r.Vector3,this.cursor=new r.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:r.MOUSE.ROTATE,MIDDLE:r.MOUSE.DOLLY,RIGHT:r.MOUSE.PAN},this.touches={ONE:r.TOUCH.ROTATE,TWO:r.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new r.Vector3,this._lastQuaternion=new r.Quaternion,this._lastTargetPosition=new r.Vector3,this._quat=new r.Quaternion().setFromUnitVectors(e.up,new r.Vector3(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new r.Spherical,this._sphericalDelta=new r.Spherical,this._scale=1,this._panOffset=new r.Vector3,this._rotateStart=new r.Vector2,this._rotateEnd=new r.Vector2,this._rotateDelta=new r.Vector2,this._panStart=new r.Vector2,this._panEnd=new r.Vector2,this._panDelta=new r.Vector2,this._dollyStart=new r.Vector2,this._dollyEnd=new r.Vector2,this._dollyDelta=new r.Vector2,this._dollyDirection=new r.Vector3,this._mouse=new r.Vector2,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=vn.bind(this),this._onPointerDown=Cn.bind(this),this._onPointerUp=Ln.bind(this),this._onContextMenu=Hn.bind(this),this._onMouseWheel=Dn.bind(this),this._onKeyDown=Nn.bind(this),this._onTouchStart=jn.bind(this),this._onTouchMove=kn.bind(this),this._onMouseDown=On.bind(this),this._onMouseMove=In.bind(this),this._interceptControlDown=Fn.bind(this),this._interceptControlUp=Gn.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(bt),this.update(),this.state=H.NONE}update(e=null){const t=this.object.position;Q.copy(t).sub(this.target),Q.applyQuaternion(this._quat),this._spherical.setFromVector3(Q),this.autoRotate&&this.state===H.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(i)&&isFinite(n)&&(i<-Math.PI?i+=oe:i>Math.PI&&(i-=oe),n<-Math.PI?n+=oe:n>Math.PI&&(n-=oe),i<=n?this._spherical.theta=Math.max(i,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+n)/2?Math.max(i,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const s=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=s!=this._spherical.radius}if(Q.setFromSpherical(this._spherical),Q.applyQuaternion(this._quatInverse),t.copy(this.target).add(Q),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let s=null;if(this.object.isPerspectiveCamera){const c=Q.length();s=this._clampDistance(c*this._scale);const l=c-s;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),o=!!l}else if(this.object.isOrthographicCamera){const c=new r.Vector3(this._mouse.x,this._mouse.y,0);c.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=l!==this.object.zoom;const u=new r.Vector3(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(c),this.object.updateMatrixWorld(),s=Q.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;s!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(s).add(this.object.position):(Ke.origin.copy(this.object.position),Ke.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Ke.direction))<Rn?this.object.lookAt(this.target):(xt.setFromNormalAndCoplanarPoint(this.object.up,this.target),Ke.intersectPlane(xt,this.target))))}else if(this.object.isOrthographicCamera){const s=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),s!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>ot||8*(1-this._lastQuaternion.dot(this.object.quaternion))>ot||this._lastTargetPosition.distanceToSquared(this.target)>ot?(this.dispatchEvent(bt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?oe/60*this.autoRotateSpeed*e:oe/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Q.setFromMatrixColumn(t,0),Q.multiplyScalar(-e),this._panOffset.add(Q)}_panUp(e,t){this.screenSpacePanning===!0?Q.setFromMatrixColumn(t,1):(Q.setFromMatrixColumn(t,0),Q.crossVectors(this.object.up,Q)),Q.multiplyScalar(e),this._panOffset.add(Q)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;Q.copy(n).sub(this.target);let o=Q.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/i.clientHeight,this.object.matrix),this._panUp(2*t*o/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),n=e-i.left,o=t-i.top,s=i.width,c=i.height;this._mouse.x=n/s*2-1,this._mouse.y=-(o/c)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(oe*this._rotateDelta.x/t.clientHeight),this._rotateUp(oe*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(oe*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-oe*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(oe*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-oe*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(i,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(i,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(i*i+n*n);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),n=.5*(e.pageX+i.x),o=.5*(e.pageY+i.y);this._rotateEnd.set(n,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(oe*this._rotateDelta.x/t.clientHeight),this._rotateUp(oe*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(i,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(i*i+n*n);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=(e.pageX+t.x)*.5,c=(e.pageY+t.y)*.5;this._updateZoomParameters(s,c)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new r.Vector2,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function Cn(a){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(a)&&(this._addPointer(a),a.pointerType==="touch"?this._onTouchStart(a):this._onMouseDown(a)))}function vn(a){this.enabled!==!1&&(a.pointerType==="touch"?this._onTouchMove(a):this._onMouseMove(a))}function Ln(a){switch(this._removePointer(a),this._pointers.length){case 0:this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Nt),this.state=H.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function On(a){let e;switch(a.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case r.MOUSE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(a),this.state=H.DOLLY;break;case r.MOUSE.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(a),this.state=H.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(a),this.state=H.ROTATE}break;case r.MOUSE.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(a),this.state=H.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(a),this.state=H.PAN}break;default:this.state=H.NONE}this.state!==H.NONE&&this.dispatchEvent(ut)}function In(a){switch(this.state){case H.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(a);break;case H.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(a);break;case H.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(a);break}}function Dn(a){this.enabled===!1||this.enableZoom===!1||this.state!==H.NONE||(a.preventDefault(),this.dispatchEvent(ut),this._handleMouseWheel(this._customWheelEvent(a)),this.dispatchEvent(Nt))}function Nn(a){this.enabled!==!1&&this._handleKeyDown(a)}function jn(a){switch(this._trackPointer(a),this._pointers.length){case 1:switch(this.touches.ONE){case r.TOUCH.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(a),this.state=H.TOUCH_ROTATE;break;case r.TOUCH.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(a),this.state=H.TOUCH_PAN;break;default:this.state=H.NONE}break;case 2:switch(this.touches.TWO){case r.TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(a),this.state=H.TOUCH_DOLLY_PAN;break;case r.TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(a),this.state=H.TOUCH_DOLLY_ROTATE;break;default:this.state=H.NONE}break;default:this.state=H.NONE}this.state!==H.NONE&&this.dispatchEvent(ut)}function kn(a){switch(this._trackPointer(a),this.state){case H.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(a),this.update();break;case H.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(a),this.update();break;case H.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(a),this.update();break;case H.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(a),this.update();break;default:this.state=H.NONE}}function Hn(a){this.enabled!==!1&&a.preventDefault()}function Fn(a){a.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Gn(a){a.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Bn={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class et{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Un=new r.OrthographicCamera(-1,1,1,-1,0,1);class zn extends r.BufferGeometry{constructor(){super(),this.setAttribute("position",new r.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new r.Float32BufferAttribute([0,2,0,0,2,0],2))}}const Vn=new zn;class Yn{constructor(e){this._mesh=new r.Mesh(Vn,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Un)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Xn extends et{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof r.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=r.UniformsUtils.clone(e.uniforms),this.material=new r.ShaderMaterial({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Yn(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Tt extends et{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const n=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let s,c;this.inverse?(s=0,c=1):(s=1,c=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),o.buffers.stencil.setFunc(n.ALWAYS,s,4294967295),o.buffers.stencil.setClear(c),o.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(n.EQUAL,1,4294967295),o.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),o.buffers.stencil.setLocked(!0)}}class Kn extends et{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Zn{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new r.Vector2);this._width=i.width,this._height=i.height,t=new r.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:r.HalfFloatType}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Xn(Bn),this.copyPass.material.blending=r.NoBlending,this.clock=new r.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let n=0,o=this.passes.length;n<o;n++){const s=this.passes[n];if(s.enabled!==!1){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),s.needsSwap){if(i){const c=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(c.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(c.EQUAL,1,4294967295)}this.swapBuffers()}Tt!==void 0&&(s instanceof Tt?i=!0:s instanceof Kn&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new r.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Qn extends et{constructor(e,t,i=null,n=null,o=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=o,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new r.Color}render(e,t,i){const n=e.autoClear;e.autoClear=!1;let o,s;this.overrideMaterial!==null&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(o=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(o),this.overrideMaterial!==null&&(this.scene.overrideMaterial=s),e.autoClear=n}}var jt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Et=B.createContext&&B.createContext(jt),Wn=["attr","size","title"];function qn(a,e){if(a==null)return{};var t=$n(a,e),i,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);for(n=0;n<o.length;n++)i=o[n],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(a,i)&&(t[i]=a[i])}return t}function $n(a,e){if(a==null)return{};var t={};for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){if(e.indexOf(i)>=0)continue;t[i]=a[i]}return t}function $e(){return $e=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i])}return a},$e.apply(this,arguments)}function At(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),t.push.apply(t,i)}return t}function Je(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?At(Object(t),!0).forEach(function(i){Jn(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):At(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}function Jn(a,e,t){return e=es(e),e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function es(a){var e=ts(a,"string");return typeof e=="symbol"?e:e+""}function ts(a,e){if(typeof a!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var i=t.call(a,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function kt(a){return a&&a.map((e,t)=>B.createElement(e.tag,Je({key:t},e.attr),kt(e.child)))}function tt(a){return e=>B.createElement(ns,$e({attr:Je({},a.attr)},e),kt(a.child))}function ns(a){var e=t=>{var{attr:i,size:n,title:o}=a,s=qn(a,Wn),c=n||t.size||"1em",l;return t.className&&(l=t.className),a.className&&(l=(l?l+" ":"")+a.className),B.createElement("svg",$e({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,s,{className:l,style:Je(Je({color:a.color||t.color},t.style),a.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),o&&B.createElement("title",null,o),a.children)};return Et!==void 0?B.createElement(Et.Consumer,null,t=>e(t)):e(jt)}function ss(a){return tt({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Maximize_2"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M10.513,3.066H4.93a2.058,2.058,0,0,0-1.15.22,1.6,1.6,0,0,0-.717,1.437v5.793a.5.5,0,0,0,1,0V5.107a2.521,2.521,0,0,1,.022-.689c.115-.373.469-.352.777-.352h5.651a.5.5,0,0,0,0-1Z"},child:[]},{tag:"path",attr:{d:"M3.063,13.488v5.583a2.057,2.057,0,0,0,.221,1.15,1.6,1.6,0,0,0,1.436.717h5.793a.5.5,0,0,0,0-1H5.1a2.483,2.483,0,0,1-.689-.022c-.372-.115-.352-.469-.352-.777V13.488a.5.5,0,0,0-1,0Z"},child:[]},{tag:"path",attr:{d:"M13.487,20.934H19.07a2.058,2.058,0,0,0,1.15-.22,1.6,1.6,0,0,0,.717-1.437V13.484a.5.5,0,0,0-1,0v5.409a2.521,2.521,0,0,1-.022.689c-.115.373-.469.352-.777.352H13.487a.5.5,0,0,0,0,1Z"},child:[]},{tag:"path",attr:{d:"M20.937,10.512V4.929a2.057,2.057,0,0,0-.221-1.15,1.6,1.6,0,0,0-1.436-.717H13.487a.5.5,0,0,0,0,1H18.9a2.483,2.483,0,0,1,.689.022c.372.115.352.469.352.777v5.651a.5.5,0,0,0,1,0Z"},child:[]}]}]}]})(a)}function is(a){return tt({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,96a16,16,0,0,0,16-16V48a16,16,0,0,0-16-16H176a16,16,0,0,0-16,16v8H96V48A16,16,0,0,0,80,32H48A16,16,0,0,0,32,48V80A16,16,0,0,0,48,96h8v64H48a16,16,0,0,0-16,16v32a16,16,0,0,0,16,16H80a16,16,0,0,0,16-16v-8h64v8a16,16,0,0,0,16,16h32a16,16,0,0,0,16-16V176a16,16,0,0,0-16-16h-8V96ZM176,48h32V80H176ZM48,48H80V63.9a.51.51,0,0,0,0,.2V80H48ZM80,208H48V176H80v15.9a.51.51,0,0,0,0,.2V208Zm128,0H176V176h32Zm-24-48h-8a16,16,0,0,0-16,16v8H96v-8a16,16,0,0,0-16-16H72V96h8A16,16,0,0,0,96,80V72h64v8a16,16,0,0,0,16,16h8Z"},child:[]}]})(a)}function os(a){return tt({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M14 13v-1c0-.55-.45-1-1-1H9c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1l2 1.06v-4.12L14 13zm-2-7.5 6 4.5v9H6v-9l6-4.5M12 3 4 9v12h16V9l-8-6z"},child:[]}]})(a)}function rs({children:a,onClick:e}){return j.jsx("button",{onClick:e,style:{display:"flex",alignItems:"center",justifyContent:"center",height:"2rem",width:"2rem",background:"#f9f9f9",color:"#3D3C3B",borderRadius:"50%",boxShadow:"0 0 5px rgba(0, 0, 0, 0.1)",border:"none",cursor:"pointer",padding:"0.2rem"},children:a})}function as(a){return tt({tag:"svg",attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M176 432c0 44.112-35.888 80-80 80s-80-35.888-80-80 35.888-80 80-80 80 35.888 80 80zM25.26 25.199l13.6 272C39.499 309.972 50.041 320 62.83 320h66.34c12.789 0 23.331-10.028 23.97-22.801l13.6-272C167.425 11.49 156.496 0 142.77 0H49.23C35.504 0 24.575 11.49 25.26 25.199z"},child:[]}]})(a)}function rt({children:a,text:e}){const[t,i]=B.useState(!1);return j.jsxs("div",{style:{overflow:"visible"},onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[t&&j.jsxs("section",{style:{minWidth:"8rem",position:"absolute",bottom:"100%",left:0,right:0,borderRadius:"6px",boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)",backgroundColor:"#f9f9f9",color:"black",padding:"6px",marginBottom:"6px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.3rem"},children:[j.jsx(as,{style:{color:"black",width:"10px",height:"10px"}}),j.jsx("p",{style:{margin:0,fontSize:"12px"},children:e})]}),a]})}function ve({children:a,onClick:e}){return j.jsx("button",{onClick:e,style:{display:"flex",alignItems:"center",justifyContent:"center",color:"#3D3C3B",borderRadius:"5px",border:"none",cursor:"pointer",padding:"0.2rem",background:"transparent"},children:a})}const Me=new r.Raycaster,ee=new r.Vector3,be=new r.Vector3,U=new r.Quaternion,Mt={X:new r.Vector3(1,0,0),Y:new r.Vector3(0,1,0),Z:new r.Vector3(0,0,1)},at={type:"change"},St={type:"mouseDown",mode:null},Rt={type:"mouseUp",mode:null},Pt={type:"objectChange"};class cs extends r.Controls{constructor(e,t=null){super(void 0,t);const i=new ps(this);this._root=i;const n=new ms;this._gizmo=n,i.add(n);const o=new gs;this._plane=o,i.add(o);const s=this;function c(v,x){let Y=x;Object.defineProperty(s,v,{get:function(){return Y!==void 0?Y:x},set:function(E){Y!==E&&(Y=E,o[v]=E,n[v]=E,s.dispatchEvent({type:v+"-changed",value:E}),s.dispatchEvent(at))}}),s[v]=x,o[v]=x,n[v]=x}c("camera",e),c("object",void 0),c("enabled",!0),c("axis",null),c("mode","translate"),c("translationSnap",null),c("rotationSnap",null),c("scaleSnap",null),c("space","world"),c("size",1),c("dragging",!1),c("showX",!0),c("showY",!0),c("showZ",!0),c("minX",-1/0),c("maxX",1/0),c("minY",-1/0),c("maxY",1/0),c("minZ",-1/0),c("maxZ",1/0);const l=new r.Vector3,u=new r.Vector3,f=new r.Quaternion,d=new r.Quaternion,p=new r.Vector3,m=new r.Quaternion,g=new r.Vector3,T=new r.Vector3,y=new r.Vector3,b=0,M=new r.Vector3;c("worldPosition",l),c("worldPositionStart",u),c("worldQuaternion",f),c("worldQuaternionStart",d),c("cameraPosition",p),c("cameraQuaternion",m),c("pointStart",g),c("pointEnd",T),c("rotationAxis",y),c("rotationAngle",b),c("eye",M),this._offset=new r.Vector3,this._startNorm=new r.Vector3,this._endNorm=new r.Vector3,this._cameraScale=new r.Vector3,this._parentPosition=new r.Vector3,this._parentQuaternion=new r.Quaternion,this._parentQuaternionInv=new r.Quaternion,this._parentScale=new r.Vector3,this._worldScaleStart=new r.Vector3,this._worldQuaternionInv=new r.Quaternion,this._worldScale=new r.Vector3,this._positionStart=new r.Vector3,this._quaternionStart=new r.Quaternion,this._scaleStart=new r.Vector3,this._getPointer=ls.bind(this),this._onPointerDown=us.bind(this),this._onPointerHover=hs.bind(this),this._onPointerMove=ds.bind(this),this._onPointerUp=fs.bind(this),t!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Me.setFromCamera(e,this.camera);const t=ct(this._gizmo.picker[this.mode],Me);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Me.setFromCamera(e,this.camera);const t=ct(this._plane,Me,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,St.mode=this.mode,this.dispatchEvent(St)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let o=this.space;if(i==="scale"?o="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(o="world"),n===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Me.setFromCamera(e,this.camera);const s=ct(this._plane,Me,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(n.position.applyQuaternion(U.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),o==="world"&&(n.parent&&n.position.add(ee.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(ee.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(i==="scale"){if(t.search("XYZ")!==-1){let c=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(c*=-1),be.set(c,c,c)}else ee.copy(this.pointStart),be.copy(this.pointEnd),ee.applyQuaternion(this._worldQuaternionInv),be.applyQuaternion(this._worldQuaternionInv),be.divide(ee),t.search("X")===-1&&(be.x=1),t.search("Y")===-1&&(be.y=1),t.search("Z")===-1&&(be.z=1);n.scale.copy(this._scaleStart).multiply(be),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const c=20/this.worldPosition.distanceTo(ee.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ee.copy(this.rotationAxis).cross(this.eye))*c):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Mt[t]),ee.copy(Mt[t]),o==="local"&&ee.applyQuaternion(this.worldQuaternion),ee.cross(this.eye),ee.length()===0?l=!0:this.rotationAngle=this._offset.dot(ee.normalize())*c),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(U.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(U.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(at),this.dispatchEvent(Pt)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Rt.mode=this.mode,this.dispatchEvent(Rt)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(at),this.dispatchEvent(Pt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Me}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function ls(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function hs(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function us(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function ds(a){this.enabled&&this.pointerMove(this._getPointer(a))}function fs(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function ct(a,e,t){const i=e.intersectObject(a,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const Ze=new r.Euler,F=new r.Vector3(0,1,0),Ct=new r.Vector3(0,0,0),vt=new r.Matrix4,Qe=new r.Quaternion,qe=new r.Quaternion,ue=new r.Vector3,Lt=new r.Matrix4,Be=new r.Vector3(1,0,0),Se=new r.Vector3(0,1,0),Ue=new r.Vector3(0,0,1),We=new r.Vector3,Fe=new r.Vector3,Ge=new r.Vector3;class ps extends r.Object3D{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class ms extends r.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new r.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new r.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=.5;const o=e.clone();o.color.setHex(16711680);const s=e.clone();s.color.setHex(65280);const c=e.clone();c.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const f=e.clone();f.color.setHex(255),f.opacity=.5;const d=e.clone();d.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25,e.clone().color.setHex(16776960);const g=e.clone();g.color.setHex(7895160);const T=new r.CylinderGeometry(0,.04,.1,12);T.translate(0,.05,0);const y=new r.BoxGeometry(.08,.08,.08);y.translate(0,.04,0);const b=new r.BufferGeometry;b.setAttribute("position",new r.Float32BufferAttribute([0,0,0,1,0,0],3));const M=new r.CylinderGeometry(.0075,.0075,.5,3);M.translate(0,.25,0);function v(G,O){const K=new r.TorusGeometry(G,.0075,3,64,O*Math.PI*2);return K.rotateY(Math.PI/2),K.rotateX(Math.PI/2),K}function x(){const G=new r.BufferGeometry;return G.setAttribute("position",new r.Float32BufferAttribute([0,0,0,1,1,1],3)),G}const Y={X:[[new r.Mesh(T,o),[.5,0,0],[0,0,-Math.PI/2]],[new r.Mesh(T,o),[-.5,0,0],[0,0,Math.PI/2]],[new r.Mesh(M,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new r.Mesh(T,s),[0,.5,0]],[new r.Mesh(T,s),[0,-.5,0],[Math.PI,0,0]],[new r.Mesh(M,s)]],Z:[[new r.Mesh(T,c),[0,0,.5],[Math.PI/2,0,0]],[new r.Mesh(T,c),[0,0,-.5],[-Math.PI/2,0,0]],[new r.Mesh(M,c),null,[Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.OctahedronGeometry(.1,0),d.clone()),[0,0,0]]],XY:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.OctahedronGeometry(.2,0),i)]],XY:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},A={START:[[new r.Mesh(new r.OctahedronGeometry(.01,2),n),null,null,null,"helper"]],END:[[new r.Mesh(new r.OctahedronGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new r.Line(x(),n),null,null,null,"helper"]],X:[[new r.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new r.Line(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new r.Line(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},P={XYZE:[[new r.Mesh(v(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new r.Mesh(v(.5,.5),o)]],Y:[[new r.Mesh(v(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new r.Mesh(v(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new r.Mesh(v(.75,1),p),null,[0,Math.PI/2,0]]]},C={AXIS:[[new r.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={XYZE:[[new r.Mesh(new r.SphereGeometry(.25,10,8),i)]],X:[[new r.Mesh(new r.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new r.Mesh(new r.TorusGeometry(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new r.Mesh(new r.TorusGeometry(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new r.Mesh(new r.TorusGeometry(.75,.1,2,24),i)]]},re={X:[[new r.Mesh(y,o),[.5,0,0],[0,0,-Math.PI/2]],[new r.Mesh(M,o),[0,0,0],[0,0,-Math.PI/2]],[new r.Mesh(y,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new r.Mesh(y,s),[0,.5,0]],[new r.Mesh(M,s)],[new r.Mesh(y,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new r.Mesh(y,c),[0,0,.5],[Math.PI/2,0,0]],[new r.Mesh(M,c),[0,0,0],[Math.PI/2,0,0]],[new r.Mesh(y,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.BoxGeometry(.1,.1,.1),d.clone())]]},W={X:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,.3,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new r.Mesh(new r.CylinderGeometry(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new r.Mesh(new r.BoxGeometry(.2,.2,.2),i),[0,0,0]]]},le={X:[[new r.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new r.Line(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new r.Line(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function X(G){const O=new r.Object3D;for(const K in G)for(let se=G[K].length;se--;){const k=G[K][se][0].clone(),ae=G[K][se][1],$=G[K][se][2],he=G[K][se][3],Z=G[K][se][4];k.name=K,k.tag=Z,ae&&k.position.set(ae[0],ae[1],ae[2]),$&&k.rotation.set($[0],$[1],$[2]),he&&k.scale.set(he[0],he[1],he[2]),k.updateMatrix();const te=k.geometry.clone();te.applyMatrix4(k.matrix),k.geometry=te,k.renderOrder=1/0,k.position.set(0,0,0),k.rotation.set(0,0,0),k.scale.set(1,1,1),O.add(k)}return O}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=X(Y)),this.add(this.gizmo.rotate=X(P)),this.add(this.gizmo.scale=X(re)),this.add(this.picker.translate=X(E)),this.add(this.picker.rotate=X(L)),this.add(this.picker.scale=X(W)),this.add(this.helper.translate=X(A)),this.add(this.helper.rotate=X(C)),this.add(this.helper.scale=X(le)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:qe;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let o=0;o<n.length;o++){const s=n[o];s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition);let c;if(this.camera.isOrthographicCamera?c=(this.camera.top-this.camera.bottom)/this.camera.zoom:c=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(c*this.size/4),s.tag==="helper"){s.visible=!1,s.name==="AXIS"?(s.visible=!!this.axis,this.axis==="X"&&(U.setFromEuler(Ze.set(0,0,0)),s.quaternion.copy(i).multiply(U),Math.abs(F.copy(Be).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(U.setFromEuler(Ze.set(0,0,Math.PI/2)),s.quaternion.copy(i).multiply(U),Math.abs(F.copy(Se).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(U.setFromEuler(Ze.set(0,Math.PI/2,0)),s.quaternion.copy(i).multiply(U),Math.abs(F.copy(Ue).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(U.setFromEuler(Ze.set(0,Math.PI/2,0)),F.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(vt.lookAt(Ct,F,Se)),s.quaternion.multiply(U),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),ee.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ee.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(ee),s.visible=this.dragging):(s.quaternion.copy(i),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1));continue}s.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(F.copy(Be).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(F.copy(Se).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(F.copy(Ue).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(F.copy(Ue).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(F.copy(Be).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(F.copy(Se).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(Qe.copy(i),F.copy(this.eye).applyQuaternion(U.copy(i).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(vt.lookAt(this.eye,Ct,Se)),s.name==="X"&&(U.setFromAxisAngle(Be,Math.atan2(-F.y,F.z)),U.multiplyQuaternions(Qe,U),s.quaternion.copy(U)),s.name==="Y"&&(U.setFromAxisAngle(Se,Math.atan2(F.x,F.z)),U.multiplyQuaternions(Qe,U),s.quaternion.copy(U)),s.name==="Z"&&(U.setFromAxisAngle(Ue,Math.atan2(F.y,F.x)),U.multiplyQuaternions(Qe,U),s.quaternion.copy(U))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(l){return s.name===l}))&&(s.material.color.setHex(16776960),s.material.opacity=1)}super.updateMatrixWorld(e)}}class gs extends r.Mesh{constructor(){super(new r.PlaneGeometry(1e5,1e5,2,2),new r.MeshBasicMaterial({visible:!1,wireframe:!0,side:r.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),We.copy(Be).applyQuaternion(t==="local"?this.worldQuaternion:qe),Fe.copy(Se).applyQuaternion(t==="local"?this.worldQuaternion:qe),Ge.copy(Ue).applyQuaternion(t==="local"?this.worldQuaternion:qe),F.copy(Fe),this.mode){case"translate":case"scale":switch(this.axis){case"X":F.copy(this.eye).cross(We),ue.copy(We).cross(F);break;case"Y":F.copy(this.eye).cross(Fe),ue.copy(Fe).cross(F);break;case"Z":F.copy(this.eye).cross(Ge),ue.copy(Ge).cross(F);break;case"XY":ue.copy(Ge);break;case"YZ":ue.copy(We);break;case"XZ":F.copy(Ge),ue.copy(Fe);break;case"XYZ":case"E":ue.set(0,0,0);break}break;case"rotate":default:ue.set(0,0,0)}ue.length()===0?this.quaternion.copy(this.cameraQuaternion):(Lt.lookAt(ee.set(0,0,0),ue,F),this.quaternion.setFromRotationMatrix(Lt)),super.updateMatrixWorld(e)}}const _s=()=>{const[a,e]=B.useState(!1),[t,i]=B.useState(!1),[n,o]=B.useState([]),s=B.useRef(),c=B.useRef(),l=B.useRef(),u=B.useRef(),f=B.useRef(),d=B.useRef(null),p=B.useRef(new N.Raycaster),m=B.useRef(null),g=B.useRef(null),T=B.useRef(null),y=new Yt,b=new DRACOLoader;b.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.7/"),b.setDecoderConfig({type:"js"}),y.setDRACOLoader(b),B.useEffect(()=>{const E=s.current.clientWidth,A=s.current.clientHeight,P=new N.Scene;P.background=new N.Color(14346226),f.current=P;const C=new N.PerspectiveCamera(75,E/A,.1,1e3);C.position.set(-17,26,16),c.current=C;const L=new N.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,stencil:!0});L.setPixelRatio(window.devicePixelRatio),L.setSize(E,A),L.shadowMap.enabled=!0,L.shadowMap.type=N.PCFSoftShadowMap,L.outputEncoding=N.sRGBEncoding,L.localClippingEnabled=!0,L.toneMapping=N.ACESFilmicToneMapping,L.physicallyCorrectLights=!0,s.current.appendChild(L.domElement),u.current=L;function re(){L.render(P,C)}const W=new Pn(C,L.domElement);W.dampingFactor=.2,W.enableDamping=!0,W.target.set(3,7,-3),l.current=W;const le=new cs(C,L.domElement);le.addEventListener("objectChange",re),le.addEventListener("dragging-changed",function(I){W.enabled=!I.value}),T.current=le;const X=new N.AmbientLight(16777215,.3);P.add(X);const G=new N.HemisphereLight(16777215,16777215,.5);P.add(G);const O=new N.DirectionalLight;O.color.setHex(16777215),O.intensity=4,O.castShadow=!0;const K=1.5,se=.75,k=50,ae=k*Math.sin(K)*Math.cos(se),$=k*Math.cos(K),he=k*Math.sin(K)*Math.sin(se);O.position.set(ae,$,he),O.shadow.radius=0,O.shadow.mapSize.width=8192,O.shadow.mapSize.height=8192,O.shadow.camera.near=.1,O.shadow.camera.far=100,O.shadow.camera.left=-15,O.shadow.camera.right=15,O.shadow.camera.top=15,O.shadow.camera.bottom=-15,O.shadow.bias=-2e-4,O.shadow.normalBias=.001,P.add(O);const Z=new Bt.GUI,te=Z.addFolder("Ambient Light");te.add(X,"intensity",0,10,.1).name("Intensity");const ze={color:X.color.getHex()};te.addColor(ze,"color").name("Color").onChange(I=>{X.color.setHex(I)});const Re=Z.addFolder("Hemisphere Light");Re.add(G,"intensity",0,10,.1).name("Intensity");const Oe={skyColor:G.color.getHex(),groundColor:G.groundColor.getHex()};Re.addColor(Oe,"skyColor").name("Sky Color").onChange(I=>{G.color.setHex(I)}),Re.addColor(Oe,"groundColor").name("Ground Color").onChange(I=>{G.groundColor.setHex(I)});const ge=Z.addFolder("Directional Light");ge.add(O,"intensity",0,10,.1).name("Intensity");const Ve={color:O.color.getHex()};ge.addColor(Ve,"color").name("Color").onChange(I=>{O.color.setHex(I)});const Pe={x:O.position.x,y:O.position.y,z:O.position.z};ge.add(Pe,"x",-100,100,.1).name("Position X").onChange(I=>{O.position.x=I}),ge.add(Pe,"y",-100,100,.1).name("Position Y").onChange(I=>{O.position.y=I}),ge.add(Pe,"z",-100,100,.1).name("Position Z").onChange(I=>{O.position.z=I});const de=[];for(let I=0;I<5;I++){const V=new N.SpotLight(16777215,1);V.position.set((I-2)*5,10,5),V.castShadow=!0,V.angle=Math.PI/6,V.penumbra=.5,P.add(V),de.push({color:V.color.getHex(),intensity:V.intensity,x:V.position.x,y:V.position.y,z:V.position.z});const q=Z.addFolder(`SpotLight ${I+1}`);q.addColor(de[I],"color").name("Color").onChange(h=>{V.color.setHex(h)}),q.add(de[I],"intensity",0,10,.1).name("Intensity").onChange(h=>{V.intensity=h}),q.add(de[I],"x",-20,20,.1).name("Position X").onChange(h=>{V.position.x=h}),q.add(de[I],"y",0,20,.1).name("Position Y").onChange(h=>{V.position.y=h}),q.add(de[I],"z",-20,20,.1).name("Position Z").onChange(h=>{V.position.z=h})}let xe=[];y.load(modelRoute,I=>{const V=I.scene;V.traverse(q=>{if(q.isMesh){q.material.metalness=.5,q.material.roughness=.8,q.material.side=N.DoubleSide,q.castShadow=!0,q.receiveShadow=!0;const h=q.name.match(/<(\d{7})/),_=h&&h[1];xe.push(_),q.geometry.computeVertexNormals()}}),P.add(V),xe.length!==n.length&&o(xe),d.current=new N.Box3().setFromObject(V)},I=>{console.log("Modelo cargado")},I=>{console.error("Error cargando el modelo:",I)});const Te=new Zn(L);Te.addPass(new Qn(P,C));const ie=new Gt.N8AOPass(P,C,E,A);Te.addPass(ie),ie.configuration.gammaCorrection=!1,ie.configuration.aoRadius=5,ie.configuration.distanceFalloff=1,ie.configuration.intensity=5,ie.configuration.color=new N.Color(0,0,0),ie.setQualityMode("high");const _e=new N.WebGLRenderTarget(E,A);_e.depthTexture=new N.DepthTexture(E,A,N.UnsignedIntType),_e.depthTexture.format=N.DepthFormat,_e.depthTexture=new N.DepthTexture(E,A,N.UnsignedInt248Type),_e.depthTexture.format=N.DepthStencilFormat;const Ie=Z.addFolder("AAO");Ie.add(ie.configuration,"aoRadius",.1,10,.1).name("AO Radius"),Ie.add(ie.configuration,"distanceFalloff",.1,5,.1).name("Distance Falloff"),Ie.add(ie.configuration,"intensity",0,10,.1).name("Intensity");const De=()=>{requestAnimationFrame(De),W.update(),Te.render()};return De(),window.addEventListener("resize",()=>{L.setSize(window.innerWidth,window.innerHeight),Te.setSize(window.innerWidth,window.innerHeight),C.aspect=window.innerWidth/window.innerHeight,C.updateProjectionMatrix()}),()=>{window.removeEventListener("resize",handleResize),s.current&&s.current.removeChild(L.domElement),u.current&&u.current.dispose()}},[]),B.useEffect(()=>{const E=u.current,A=P=>{t&&M(P)};t?E.domElement.addEventListener("dblclick",A):E.domElement.removeEventListener("dblclick",A)},[t]);const M=E=>{const A=u.current,P=c.current,C=f.current,L=p.current,re=T.current;if(!A||!P||!C||!L||!re)return;const W=A.domElement.getBoundingClientRect(),le=(E.clientX-W.left)/W.width*2-1,X=-((E.clientY-W.top)/W.height)*2+1;L.setFromCamera({x:le,y:X},P);const G=L.intersectObjects(C.children,!0);if(G.length===0)return;const K=G[0].point,se=new N.Plane;m.current=se;const k=re.getHelper();C.add(k),g.current&&(C.remove(g.current),re.detach(g.current),g.current.geometry.dispose(),g.current.material.dispose(),g.current=null);const ae=8,$=new N.PlaneGeometry(ae,ae),he=new N.MeshPhongMaterial({color:9491967,side:N.DoubleSide,transparent:!0,opacity:.3}),Z=new N.Mesh($,he);Z.position.copy(K);const te=new N.Vector3;P.getWorldDirection(te),Math.abs(te.y)>.7?te.y>0?Z.rotation.set(-Math.PI/2,0,0):Z.rotation.set(Math.PI/2,0,0):Z.rotation.set(0,0,0),C.add(Z),g.current=Z,v(),A.clippingPlanes=[se],re.attach(Z),re.addEventListener("change",v)},v=()=>{const E=m.current,A=g.current;if(!E||!A)return;const P=new N.Vector3(0,0,1);A.getWorldDirection(P);const C=new N.Vector3().setFromMatrixPosition(A.matrixWorld);E.setFromNormalAndCoplanarPoint(P,C)},x=(E,A=1)=>{const P=c.current,C=l.current;if(!P||!C)return;const L=new N.Vector3;d.current.getCenter(L),Ft.gsap.to(P.position,{duration:A,x:E.x,y:E.y,z:E.z,ease:"power2.inOut",onUpdate:()=>{C.update()},onComplete:()=>{P.lookAt(L),C.target.copy(L),C.update()}})},Y=()=>{const E=f.current,A=u.current,P=T.current;g.current&&(E.remove(g.current),P.detach(g.current),g.current.geometry.dispose(),g.current.material.dispose(),g.current=null),A&&(A.clippingPlanes=[]),m.current=null};return B.useEffect(()=>{t||Y()},[t]),j.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[j.jsx("section",{ref:s,style:{position:"relative",width:"100%",height:"100%"}}),j.jsxs("nav",{style:{display:"flex",gap:"15px",position:"absolute",bottom:"20px",left:"50%",padding:"10px"},children:[j.jsx(rt,{text:"Centra la camara en el modelo",children:j.jsx(rs,{onClick:()=>x({x:-17,y:26,z:16}),children:j.jsx(ss,{})})}),j.jsx(rt,{text:"Activa un boundingbox alrededor del modelo",children:j.jsx("button",{onClick:()=>i(!t),style:{display:"flex",alignItems:"center",justifyContent:"center",height:"2rem",width:"2rem",background:t?"#3D3C3B":"#f9f9f9",color:t?"#f9f9f9":"#3D3C3B",borderRadius:"50%",boxShadow:"0 0 5px rgba(0, 0, 0, 0.1)",border:"none",cursor:"pointer",padding:"0.2rem"},children:j.jsx(is,{})})}),j.jsxs("div",{style:{position:"relative"},children:[j.jsx(rt,{text:"Abre Menu de navegacion de la camara",children:j.jsx("button",{onClick:()=>e(!a),style:{display:"flex",alignItems:"center",justifyContent:"center",height:"2rem",width:"2rem",background:a?"#3D3C3B":"#f9f9f9",color:a?"#f9f9f9":"#3D3C3B",borderRadius:"50%",boxShadow:"0 0 5px rgba(0, 0, 0, 0.1)",border:"none",cursor:"pointer",padding:"0.2rem"},children:j.jsx(os,{})})}),a&&j.jsxs("div",{style:{position:"absolute",display:"flex",flexDirection:"column",gap:"5px",bottom:"100%",marginBottom:"5px",padding:"5px",background:"#f9f9f9",borderRadius:"5px",boxShadow:"0 0 5px rgba(0,0,0,0.1)"},children:[j.jsx(ve,{onClick:()=>x({x:0,y:30,z:0}),children:"Arriba"}),j.jsx(ve,{onClick:()=>x({x:-30,y:0,z:0}),children:"Izquierda"}),j.jsx(ve,{onClick:()=>x({x:0,y:-30,z:0}),children:"Abajo"}),j.jsx(ve,{onClick:()=>x({x:30,y:0,z:0}),children:"Derecha"}),j.jsx(ve,{onClick:()=>x({x:0,y:0,z:30}),children:"Frente"}),j.jsx(ve,{onClick:()=>x({x:0,y:0,z:-30}),children:"Detras"})]})]})]}),n&&j.jsxs("section",{style:{display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:"5px",gap:"10px",position:"absolute",width:"300px",bottom:"50px",left:"5px",padding:"10px",background:"#f9f9f9",color:"#3D3C3B"},children:[j.jsx("p",{children:"Meshes in the model"}),j.jsx("div",{style:{overflowY:"auto",maxHeight:"200px"},children:n.map((E,A)=>j.jsx("p",{style:{margin:0,fontSize:"10px"},children:E},A))})]})]})},ys=()=>j.jsx(_s,{});exports.Visor=ys;
